<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Login</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <nav>
    <a href="index.html">Home</a>
    <a href="gallery.html">Gallery</a>
    <a href="register.html">Register</a>
    <a href="login.html">Login</a>
    <a href="admin.html">Admin</a>
  </nav>

  <div class="container">
    <div class="card">
      <h2>Login</h2>
      <form id="loginForm">
        <input id="email" placeholder="Email" type="email" required>
        <input id="password" placeholder="Password" type="password" required>
        <button type="submit">Login</button>
      </form>

      <div class="row" style="margin-top:10px;">
        <button id="logoutBtn" type="button">Logout</button>
        <button id="goGallery" type="button">Go Gallery</button>
      </div>

      <p class="small" id="status"></p>
    </div>
  </div>

  <script type="module">
  import { apiFetch } from "./js/api.js";
  import { saveAuth, clearAuth, getRole } from "./js/auth.js";

  const loginForm = document.getElementById("loginForm");
  const emailEl = document.getElementById("email");
  const passEl = document.getElementById("password");
  const logoutBtn = document.getElementById("logoutBtn");
  const goGallery = document.getElementById("goGallery");
  const status = document.getElementById("status");

  function refreshStatus() {
    const role = getRole();
    status.textContent = role ? `Logged in as: ${role}` : "Not logged in.";
  }
  refreshStatus();

  loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    try {
      const data = await apiFetch("/api/auth/login", {
        method: "POST",
        body: { email: emailEl.value, password: passEl.value }
      });
      saveAuth(data.token, data.role);
      alert("Logged in!");
      refreshStatus();
    } catch (err) {
      alert(err.message);
    }
  });

  logoutBtn.addEventListener("click", () => {
    clearAuth();
    alert("Logged out.");
    refreshStatus();
  });

  goGallery.addEventListener("click", () => {
    window.location.href = "gallery.html";
  });
</script>

</body>
</html>
